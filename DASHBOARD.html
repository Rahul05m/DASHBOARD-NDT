<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NDT Execution Dashboard</title>
<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --border:#e5e7eb;
  --text:#0f172a;
  --muted:#64748b;
  --accent:#0ea5e9;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system;
  background:var(--bg);
  color:var(--text);
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}
h1{
  margin:0 0 16px;
  font-size:24px;
}
h3{
  margin:0 0 12px;
  font-size:16px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  padding:14px;
  margin-bottom:16px;
}
.grid-2{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:16px;
}
.small{font-size:12px;color:var(--muted)}
input,select,button{
  width:100%;
  padding:8px;
  border-radius:6px;
  border:1px solid #cbd5e1;
  font-size:13px;
}
button{
  background:var(--accent);
  color:#fff;
  border:0;
  cursor:pointer;
}
button:hover{opacity:.9}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  padding:8px;
  border-bottom:1px solid var(--border);
  text-align:left;
}
th{background:#fafafa}
.progress-bg{
  height:8px;
  background:#e5e7eb;
  border-radius:6px;
}
.progress-bar{
  height:8px;
  border-radius:6px;
  background:var(--accent);
}
.kpi-strip{
  display:grid;
  grid-template-columns:1.5fr 1fr 1fr 1fr;
  gap:16px;
  align-items:center;
}
.kpi strong{font-size:18px}
.stack{
  display:flex;
  flex-direction:column;
  gap:10px;
}
</style>
</head>
<body>
<div class="container">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
  <h1>NDT Exe – DASHBOARD</h1>
  <button type="button" onclick="exportCSV()">Export CSV</button>
</div>


<!-- KPI STRIP -->
<div class="card kpi-strip">
  <div class="kpi">
    <div class="small">Overall Progress</div>
    <strong id="overallPct">0%</strong>
    <div class="progress-bg">
      <div id="overallBar" class="progress-bar" style="width:0%"></div>
    </div>
  </div>
  <div class="kpi">
    <div class="small">Planned Amount</div>
    <strong id="plannedAmt">₹ 0</strong>
  </div>
  <div class="kpi">
    <div class="small">Earned Value</div>
    <strong id="earnedAmt">₹ 0</strong>
  </div>
  <div class="kpi">
  <div class="small">Status</div>
  <div id="statusTxt" style="font-weight:600; line-height:1.6">
    <div>Pending: 0</div>
    <div>Ongoing: 0</div>
    <div>Completed: 0</div>
  </div>
</div>
</div>

<!-- ACTIVITY PROGRESS -->
<div class="card">
  <h3>Activity Progress</h3>
  <div id="chart" class="stack"></div>
</div>

<!-- MASTER + ADD ACTIVITY -->
<div class="grid-2">
  <div class="card">
    <h3>Master Table</h3>
    <table>
      <thead>
        <tr>
          <th>Activity</th>
          <th>Planned</th>
          <th>Completed</th>
          <th>%</th>
          <th>Remaining</th>
          <th>Earned ₹</th>
        </tr>
      </thead>
      <tbody id="masterBody"></tbody>
    </table>
  </div>

  <div class="card">
    <h3>Add Activity</h3>
    <div class="stack">
      <input id="actName" placeholder="Test Name">
      <input id="actQty" type="number" placeholder="Planned Qty">
      <input id="actRate" type="number" placeholder="Unit Rate ₹">
      <button type="button" onclick="addActivity()">Add</button>
    </div>
  </div>
</div>

<!-- DAILY LOGS + ADD DAILY LOG -->
<div class="grid-2">
  <div class="card">
    <h3>Daily Logs</h3>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Activity</th>
          <th>Qty</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="logBody"></tbody>
    </table>
  </div>

  <div class="card">
    <h3>Add Daily Log</h3>
    <div class="stack">
      <input type="date" id="logDate">
      <select id="logActivity"></select>
      <input type="number" id="logQty" placeholder="Completed Qty">
      <button type="button" onclick="addLog()">Add</button>
    </div>
  </div>
  <div class="card">
  <h3>Quick Controls</h3>
  <div class="stack">
    <button type="button" style="background:#ef4444" onclick="clearLogs()">Clear Logs</button>
    <button type="button" onclick="downloadHTML()">Download HTML</button>
    <div class="small">
      This single HTML file stores data in your browser (localStorage).
      No server needed. Works offline after first load.
    </div>
  </div>
</div>
</div>

</div>
<script>
const KM='ndt_master';
const KL='ndt_logs';
let master=JSON.parse(localStorage.getItem(KM))||[];
let logs=JSON.parse(localStorage.getItem(KL))||[];
const ₹=n=>'₹ '+(n||0).toLocaleString('en-IN');
function save(){
  localStorage.setItem(KM,JSON.stringify(master));
  localStorage.setItem(KL,JSON.stringify(logs));
}
function addActivity(){
  const n=actName.value.trim();
  if(!n) return alert('Name required');
  master.push({
    activity:n,
    qty:+actQty.value||0,
    rate:+actRate.value||0
  });
  actName.value=actQty.value=actRate.value='';
  save(); render();
}
function addLog(){
  if(!logActivity.value) return alert('No activity');
  logs.push({
    date:logDate.value,
    activity:logActivity.value,
    qty:+logQty.value||0
  });
  logQty.value='';
  save(); render();
}
function render(){
  const body=masterBody; body.innerHTML='';
  const chart=document.getElementById('chart'); chart.innerHTML='';
  logActivity.innerHTML='';
  let plan=0, earn=0, p=0,o=0,c=0;
  master.forEach(m=>{
    const done=logs.filter(l=>l.activity===m.activity)
                   .reduce((s,l)=>s+l.qty,0);
    const pct=m.qty?Math.min(done/m.qty,1):0;
    const ev=pct*m.qty*m.rate;
    plan+=m.qty*m.rate; earn+=ev;
    pct===0?p++:pct<1?o++:c++;
    body.innerHTML+=`
      <tr>
        <td>${m.activity}</td>
        <td>${m.qty}</td>
        <td>${done}</td>
        <td>${(pct*100).toFixed(1)}%</td>
        <td>${Math.max(m.qty-done,0)}</td>
        <td>${₹(ev)}</td>
      </tr>`;
    chart.innerHTML+=`
      <div class="small">${m.activity}</div>
      <div class="bar-bg">
        <div class="bar" style="width:${pct*100}%"></div>
      </div>`;
    logActivity.innerHTML+=`<option>${m.activity}</option>`;
  });
  overallPct.textContent=master.length
    ?((master.reduce((s,m)=>s+(logs.filter(l=>l.activity===m.activity)
    .reduce((a,b)=>a+b.qty,0)/(m.qty||1)),0)/master.length)*100).toFixed(1)+'%'
    :'0%';
  overallBar.style.width=overallPct.textContent;
  plannedAmt.textContent=₹(plan);
  earnedAmt.textContent=₹(earn);
 statusTxt.innerHTML = `
  <div>Pending: ${p}</div>
  <div>Ongoing: ${o}</div>
  <div>Completed: ${c}</div>
`;
  logBody.innerHTML='';
  logs.forEach((l,i)=>{
    logBody.innerHTML+=`
      <tr>
        <td>${l.date}</td>
        <td>${l.activity}</td>
        <td>${l.qty}</td>
        <td><button onclick="delLog(${i})">X</button></td>
      </tr>`;
  });
}
function delLog(i){
  logs.splice(i,1); save(); render();
}
  function exportCSV(){
  let csv = "Activity,Planned,Completed,Percent,Remaining,Earned\n";

  master.forEach(m=>{
    const done = logs.filter(l=>l.activity===m.activity)
                     .reduce((s,l)=>s+l.qty,0);
    const pct = m.qty ? ((done/m.qty)*100).toFixed(1) : 0;
    const remaining = Math.max(m.qty-done,0);
    const earned = (done/m.qty||0)*m.qty*m.rate;

    csv += `${m.activity},${m.qty},${done},${pct}%,${remaining},${earned}\n`;
  });

  const blob = new Blob([csv],{type:"text/csv"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "NDT_Execution_Report.csv";
  a.click();

  URL.revokeObjectURL(url);
    function clearLogs(){
  if(!confirm("Clear all daily logs?")) return;
  logs = [];
  save();
  render();
}

function downloadHTML(){
  const a = document.createElement("a");
  a.href = window.location.href;
  a.download = "NDT_Dashboard.html";
  a.click();
}
}
render();
</script>
</body>
</html>
